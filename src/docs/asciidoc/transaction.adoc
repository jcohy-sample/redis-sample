[[redis-transaction]]
== Redis 事务

Redis 事务：可以一次执行多个命令，本质是一组命令的集合。一个事务中的所有命令都会序列化，按顺序地串行化执行而不会被其它命令插入，不许加塞

=== Redis 事务 VS 数据库事务

* 单独的隔离操作：Redis 的事务仅仅是保证事务里的操作会被连续独占的执行，redis 命令执行是单线程架构，在执行完事务内所有指令前是不可能再去同时执行其他客户端的请求的
* 没有隔离级别的概念：因为事务提交前任何指令都不会被实际执行，也就不存在”事务内的查询要看到事务里的更新，在事务外查询不能看到”这种问题了
* 不保证原子性：Redis 的事务不保证原子性，也就是不保证所有指令同时成功或同时失败，只有决定是否开始执行全部指令的能力，没有执行到一半进行回滚的能力
* 排它性：Redis 会保证一个事务内的命令依次执行，而不会被其它命令插入

* MULTI：开启，以 `MULTI` 开始一个事务
* 入队，将多个命令入队到事务中，接到这些命令并不会立即执行， 而是放到等待执行的事务队列里面
* EXEC：执行，由 `EXEC` 命令触发事务
* DISCARD：放弃事务，放弃事务执行块内的所有命令
* WATCH：监听一个或多个 key，`WATCH` 命令是一种乐观锁的实现，Redis 在修改的时候会检测数据是否被更改，如果更改了，则执行失败
* UNWATCH：取消 `WATCH` 命令对所有 key 的监视

NOTE:: 一旦执行了 exec， 之前加的监控锁都会被取消掉了。当客户端连接丢失的时候(比如退出链接)，所有东西都会被取消监视