== 内存淘汰策略

=== Redis 过期键的删除策略

Redis 使用定期删除和惰性删除两种策略来删除过期键。

. 定期删除（定时任务）：Redis 每隔一段时间会主动扫描一部分设置了过期时间的键，并删除其中已过期的键。这个周期性的删除操作由 `redis-server` 服务器配置文件中的 `hz` 参数控制，默认值为 10。定期删除策略确保了过期键的及时删除，但是可能会产生一些额外的 CPU 负载，尤其在大数据集上。
. 惰性删除（访问时检测）：当客户端尝试获取一个键时，Redis 会主动检查该键是否过期，如果过期则会立即删除。惰性删除策略无需消耗额外的 CPU 时间，但也意味着如果一个过期键长时间未被访问，则不会被删除，可能会占用一定的内存空间。可以使用 `lazyfree-lazy-eviction=yes`  开启惰性删除

需要注意的是，Redis 的过期键删除操作是在键第一次被访问时进行的，如果过期键一直未被访问，它将一直保留在内存中。此外，阻塞操作（如 `BLPOP` 或者订阅模式下的 `SUBSCRIBE`）不会触发键的过期和删除操作。

可以通过在 Redis 配置文件中的 `maxmemory-policy` 参数来设置过期键的删除策略。常用的策略包括 `volatile-lru`、`volatile-ttl`、`volatile-random`、`allkeys-lru`、`allkeys-random` 等，具体策略同样适用于内存淘汰中提到的策略。

综合使用定期删除和惰性删除可以确保 Redis 中的过期键能够及时删除并释放内存空间，保证系统的稳定和性能。

=== Redis 内存淘汰策略

LRU：Least Recently Used，最近最少使用的页面置换算法，淘汰最长时间未被使用的页面，看页面最后一次被使用到发生调度的时间长短，首先淘汰最长时间未被使用的页面

LFU：Least Frequently Used，最近不常用的页面置换算法，淘汰一定时期内被访问次数最少的也，看一定时间段内页面被使用的频率，淘汰一定时期内被访问次数最少的页。

淘汰策略：

* noeviction: 不会驱逐任何 key，表示即使内存达到上限也不进行置换，所有能引起内存增加的命令都会返回 error
* allkeys-lru：对所有 key 使用 LRU 算法进行删除，优先删除最近最不常使用的的 key，用以保存数据。
* volatile-lru：对所有设置了过期时间的 key 使用 LRU 算法进行删除。
* allkeys-random：对所有 key 进行随机删除。
* volatile-random：对所有设置了过期时间的 key 进行随机删除。
* volatile-ttl：删除马上要过期的 key。
* allkeys-lfu：对所有 key 使用 LFU 算法进行删除。
* volatile-lfu：对所有设置了过期时间的 key 使用 LFU 算法进行删除。
